[h1]Version 1.5 â€“ Performance & Code Quality Update[/h1]

[i]Major performance improvements with Smart Detection System and code quality enhancements![/i]

[b]ðŸš€ Major Changes:[/b]

[list]
[*] [b]Smart Detection System:[/b] Intelligent factory change detection reduces unnecessary calculations by [b]75-85%[/b] while maintaining instant responsiveness
[*] [b]Unified AI System:[/b] AI countries now use the same smart detection as players â€“ immediate updates when factories change (no more 30-day delays)
[*] [b]Instant Territory Updates:[/b] Research slots update immediately when you gain or lose territory
[*] [b]Code Quality:[/b] 83% reduction in redundant code, improved maintainability
[/list]

---

[b]Performance Improvements:[/b]

[list]
[*] [b]75-85% reduction[/b] in unnecessary calculations for typical gameplay
[*] Average daily performance impact reduced by [b]~70%[/b]: typically [b]~0.3ms[/b] (range: 0.2-0.5ms, down from ~1ms)
[*] Factory changes are still detected immediately â€“ no delay in responsiveness
[*] Weekly fallback ensures custom buildings from submods are still detected within 7 days
[*] Smoother gameplay, especially in large mod setups
[*] Better compatibility with performance-heavy mods
[/list]

---

[b]AI System Improvements:[/b]

[list]
[*] AI countries now use the same Smart Detection System as players
[*] AI countries are updated immediately when factories change (no more waiting 30 days)
[*] Fixes confusion caused by the previous 30-day interval where AI research slots seemed unresponsive
[*] AI countries get an initial calculation at game start to ensure correct research slots from day 1
[*] Weekly fallback (7 days) ensures AI research slots stay up to date even without factory changes
[*] [b]Configurable update frequency:[/b] AI update frequency is now configurable via [b]dr_ai_update_frequency[/b] (default: 14 days, can be customized by submods)
[/list]

---

[b]New Features:[/b]

[list]
[*] [b]Immediate recalculation on territory changes:[/b] Research slots now update instantly when you gain or lose territory via [b]on_state_control_changed[/b]
[*] This ensures research slots reflect your current industrial capacity immediately after conquest or loss of states
[/list]

---

[b]Code Quality Improvements:[/b]

[list]
[*] Consolidated government type detection logic ([b]83% reduction[/b] in redundant code)
[*] Refactored peace bonus calculations for better maintainability
[*] Improved code structure while maintaining full backward compatibility
[/list]

---

[b]For Modders:[/b]

[b]New Helper Effects:[/b]

[list]
[*] [b]dr_set_government_popularity[/b] â€“ Simplified government type detection
[*] [b]dr_map_government_support_to_peace_bonus[/b] â€“ Streamlined peace bonus mapping
[*] [b]dr_check_for_factory_changes[/b] â€“ Factory change detection system
[*] [b]dr_recalculate_if_needed[/b] â€“ Conditional recalculation wrapper
[/list]

[b]Usage Examples:[/b]

[list]
[*] For government support calculations: Use [b]dr_set_government_popularity[/b] + [b]dr_get_government_support_factor[/b]
[*] For peace bonus mapping: Use [b]dr_map_government_support_to_peace_bonus[/b]
[*] For custom recalculation logic: Reference [b]dr_check_for_factory_changes[/b] and [b]dr_recalculate_if_needed[/b]
[/list]

See [b]docs/technical_reference.md[/b] and [b]docs/submodding_guide.md[/b] for complete documentation and examples.

---

[b]Bug Fixes:[/b]

[list]
[*] Fixed syntax error in on_actions file that could cause parsing issues
[*] Improved defensive programming with better validation checks
[/list]

---

[b]Documentation:[/b]

[list]
[*] Updated [b]technical_reference.md[/b] with new helper effects and Smart Detection System documentation
[*] Expanded [b]submodding_guide.md[/b] with examples for using new helper effects
[*] Extended [b]performance.md[/b] with detailed analysis of the Smart Detection System
[/list]

---

[b]Save-Game Compatibility:[/b]

[i]This update is fully save-game compatible. All changes are backward compatible and existing campaigns will continue to work without issues. The performance improvements will apply automatically when you load your save game, but no variables or progress will be lost.[/i]

---

[b]Gameplay Impact:[/b]

[i]No gameplay changes[/i] â€“ this is purely a performance and code quality update. All mechanics, game rules, and features work exactly as before, just faster and more efficiently.
